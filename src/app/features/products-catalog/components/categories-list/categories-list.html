<div class="space-y-6">

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div
            class="flex items-center gap-4 p-5 bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-px transition-all duration-200">
            <div
                class="flex-shrink-0 w-10 h-10 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 dark:text-indigo-400" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                </svg>
            </div>
            <div>
                <p class="text-2xl font-bold leading-none text-gray-900 dark:text-white">{{ totalCategories() }}</p>
                <p class="mt-1 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Total
                    Categorías</p>
            </div>
        </div>

        <div
            class="flex items-center gap-4 p-5 bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-px transition-all duration-200">
            <div
                class="flex-shrink-0 w-10 h-10 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600 dark:text-green-400" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div>
                <p class="text-2xl font-bold leading-none text-gray-900 dark:text-white">{{ activeCategories() }}</p>
                <p class="mt-1 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Activas
                </p>
            </div>
        </div>

        <div
            class="flex items-center gap-4 p-5 bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-px transition-all duration-200">
            <div
                class="flex-shrink-0 w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-600 dark:text-amber-400" fill="none"
                    viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
            </div>
            <div>
                <p class="text-2xl font-bold leading-none text-gray-900 dark:text-white">{{ inactiveCategories() }}</p>
                <p class="mt-1 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Inactivas
                </p>
            </div>
        </div>
    </div>

    <!-- Loading State (initial load only, no data yet) -->
    @if (isLoading() && categories().length === 0) {
    <div class="flex items-center justify-center py-20">
        <div class="flex flex-col items-center gap-3">
            <svg class="animate-spin h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
            <p class="text-sm text-gray-500 dark:text-gray-400">Cargando categorías...</p>
        </div>
    </div>
    }

    <!-- Dynamic Table — kept visible during reloads, dims instead of disappearing -->
    @if (categories().length > 0 || !isLoading()) {
    <div class="transition-opacity duration-200" [class.opacity-50]="isLoading()"
        [class.pointer-events-none]="isLoading()">
        <app-dynamic-table [data]="flatCategories()" [columns]="columns" [actions]="actions" title="Categorías"
            description="Organiza tus productos en jerarquías significativas."
            searchPlaceholder="Buscar por nombre o slug..." [allowImport]="true" (importData)="onImportData($event)">

            <!-- Actions Slot -->
            <div actions>
                <button type="button" (click)="openCreate()"
                    class="inline-flex items-center gap-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition-all duration-200 hover:shadow-indigo-200 dark:hover:shadow-indigo-900">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nueva Categoría
                </button>
            </div>

        </app-dynamic-table>
    </div>
    }

</div>

<!-- Drawer Overlay -->
@if (showDrawer()) {
<div class="drawer-overlay" (click)="closeDrawer()"></div>
<div class="drawer bg-white dark:bg-gray-900 flex flex-col">
    <app-category-form class="flex-1 h-full" [category]="editingCategory()" [categories]="flatCategories()"
        (saved)="onCategorySaved($event)" (cancelled)="closeDrawer()">
    </app-category-form>
</div>
}