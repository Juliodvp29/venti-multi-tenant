<div class="relative inline-block">

    <!-- Trigger button -->
    <button type="button" (click)="toggleOpen()"
        class="inline-flex items-center gap-2 rounded-xl border-0 py-2.5 pl-3 pr-3 ring-1 ring-inset ring-gray-300 dark:ring-gray-700 dark:bg-gray-800/50 text-sm transition-all focus:ring-2 focus:ring-indigo-600 whitespace-nowrap"
        [class.text-gray-900]="displayLabel()" [class.dark:text-white]="displayLabel()"
        [class.text-gray-400]="!displayLabel()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 flex-shrink-0 text-gray-400" fill="none"
            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
        </svg>
        <span>{{ displayLabel() ?? placeholder() }}</span>
        @if (value().start) {
        <button type="button" (click)="$event.stopPropagation(); clearRange()"
            class="ml-1 rounded-full text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>
        </button>
        }
    </button>

    <!-- Calendar dropdown -->
    @if (open()) {
    <div
        class="absolute right-0 z-50 mt-2 w-72 rounded-2xl bg-white dark:bg-gray-900 shadow-2xl ring-1 ring-black/10 dark:ring-white/10 p-4 animate-in slide-in-from-top-2 duration-150">

        <!-- Month nav -->
        <div class="flex items-center justify-between mb-3">
            <button type="button" (click)="prevMonth()"
                class="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            <span class="text-sm font-semibold text-gray-900 dark:text-white">
                {{ MONTHS[viewMonth()] }} {{ viewYear() }}
            </span>
            <button type="button" (click)="nextMonth()"
                class="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                </svg>
            </button>
        </div>

        <!-- Weekday headers -->
        <div class="grid grid-cols-7 mb-1">
            @for (wd of WEEKDAYS; track wd) {
            <div class="text-center text-xs font-medium text-gray-400 dark:text-gray-500 py-1">{{ wd }}</div>
            }
        </div>

        <!-- Day grid -->
        <div class="grid grid-cols-7 gap-y-0.5">
            @for (day of calendarDays(); track $index) {
            @if (day === null) {
            <div></div>
            } @else {
            <button type="button" (click)="selectDay(day)" (mouseenter)="hoverDay.set(day)"
                (mouseleave)="hoverDay.set(null)"
                class="relative h-8 w-full flex items-center justify-center text-sm transition-colors duration-100 rounded-lg focus:outline-none"
                [class.bg-indigo-600]="isStart(day) || isEnd(day)" [class.text-white]="isStart(day) || isEnd(day)"
                [class.font-semibold]="isStart(day) || isEnd(day)" [class.bg-indigo-50]="isInRange(day)"
                [class.dark:bg-indigo-900\/30]="isInRange(day)"
                [class.text-indigo-700]="isInRange(day) && !isStart(day) && !isEnd(day)"
                [class.dark:text-indigo-300]="isInRange(day) && !isStart(day) && !isEnd(day)"
                [class.hover:bg-gray-100]="!isStart(day) && !isEnd(day) && !isInRange(day)"
                [class.dark:hover:bg-gray-800]="!isStart(day) && !isEnd(day) && !isInRange(day)"
                [class.text-gray-700]="!isStart(day) && !isEnd(day)"
                [class.dark:text-gray-300]="!isStart(day) && !isEnd(day)">
                {{ day.split('-')[2] | number:'1.0-0' }}
            </button>
            }
            }
        </div>

        <!-- Hint -->
        <p class="mt-3 text-center text-xs text-gray-400 dark:text-gray-500">
            @if (selecting() === 'start') { Selecciona la fecha de inicio }
            @else { Selecciona la fecha de fin }
        </p>

    </div>
    }

</div>